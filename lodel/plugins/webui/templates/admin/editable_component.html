{% macro input(fieldname, field, value='') -%}
	<label for="field_input_{{fieldname}}" class="col-sm-2 control-label">{{fieldname}}</label>
    <div class="col-xs-6">
	{% if value == None %}
		{% set value = '' %}
	{% endif %}
	{% if field.base_type == 'bool' %}
		<input id="field_input_{{fieldname}}" class="form-control" name="field_input_{{fieldname}}" type="checkbox" checked="{% if value %}checked{% endif %}" >
	{% elif field.base_type == 'password' %}
            <input id="{{fieldname}}" name="field_input_{{fieldname}}" class="form-control" type="password"  value="{{sval}}" >
    {% elif field.base_type == 'char' or field.base_type == 'int' %}
		<input id="{{fieldname}}" class="form-control" name="field_input_{{fieldname}}" type="text" value="{{value}}" >
		{% elif field.base_type == 'text' %}
			<textarea class="form-control" name="field_input_{{fieldname}}">{{value}}</textarea>
		{% elif field.base_type == 'datetime' %}
			<!-- Handle date fields - Date format for datepicker is YY/MM/DD - TODO set this format with field.datetime_format (default is '%Y-%m-%d') -->
		 	<input class="form-control" type="text" id="field_input_{{fieldname}}" name="field_input_{{fieldname}}" />
		 	 <script type="text/javascript">
		        $(document).ready(function() {
				    $('#field_input_{{fieldname}}')
				        .datepicker({
				            autoclose: true,
				            format: 'yyyy/mm/dd'
				        });
		        });
        	</script>
    {% elif field.base_type == 'ref' %}
        {% set l_classes = field.allowed_classes %}
    	{% set ref_objects = dict() %}
    	{% for l_class in l_classes %}
    		{% set _dummy = ref_objects.update(l_class.get(None)) %} 
    		{% if 'fullname' in l_class.fieldnames() %}
    			{% set displayfield = 'fullname' %}
    		{% elif 'name' in l_class.fieldnames() %} 
    			{% set displayfield = 'name' %}
    		{% elif 'title' in l_class.fieldnames() %}
    			{% set displayfield = 'title' %}
    		{% else %}
    			{% set displayfield = l_class.uid_fieldname() %}
    		{% endif %}
    		{% set uidfield = l_class.uid_fieldname() %}
    	{% endfor %}
    	<meta id="ref_objects" data-name="{{ ref_objects }}" >
    	{% if (field.__class__ == List) %}
    		<input id="{{fieldname}}" class="form-control" name="field_input_{{fieldname}}[]" type="text" value="{{sval}}" >
    		<script type="text/javascript">
    		$(function() {
		    $('#{{fieldname}}').magicSuggest({
		        data: $('#ref_objects').data(),
		        valueField: {{ uidfield }},
		        displayField: {{ displayfield }}
		    });
		    </script>
		
		});
    	{% endif %}
        {% if value is iterable %}
            {% set sval=value|join(',') %}
        {% else %}
            {% set sval = value %}
        {% endif %}
        {% if field.directly_editable %}
            <input id="{{fieldname}}" class="form-control" name="field_input_{{fieldname}}" type="text" value="{{sval}}" >
            {% set l_classe = field.allowed_classes %}
            <p> Please enter uids to instances of {{ l_classe.__name__ }} separated by commas </p>
        {% else %}
            <input id="{{fieldname}}" class="form-control" name="field_input_{{fieldname}}" type="text" value="{{sval}}">
        {% endif %}
	{% else %}
		Unsupported base type "{{field.base_type}}" <br>
	{% endif %}
</div>
{%- endmacro %}
