{% extends "base.html" %}
{% import 'components/components.html' as components %}
{% set my_class = leapi.name2class(classname) %}
{% set uidfield = my_class.uid_fieldname()[0] %}
{% set objects = my_class.get(('%s = %s') % (uidfield, lodel_id)) %}
{% set obj = objects.pop() %}
{% if my_class.is_abstract() %}
{% set classname = obj.data('classname') %}
{% set my_class = my_class.name2class(classname) %}
{% endif %}
{% block title %}Object {{ lodel_id }} {% endblock %}
{% import "components/components.html" as components %}
{% block content %}
<ol class="breadcrumb">
  <li><a href="/lodel_i/">Home</a></li>
  <li><a href="/lodel_i/list_classes">Types</a></li>
  <li><a href="/lodel_i/show_class?classname={{ classname }}">{{ classname }}</a></li>
  <li class="active">{{ lodel_id }}</li>
</ol>
<h1>Lodel 2 - {{ classname }} with uid {{ lodel_id }}</h1>
    
<ul>
    <!-- To get a component HTML code, it is necessary to call : components.<macro_name>(args) -->
    {% for fieldname, fieldvalue in obj.fields(include_ro = True).items() %}
        {% if fieldvalue is not none %}
           {% if fieldvalue.base_type == 'ref' %}
                {% if obj.data(fieldname) is iterable %}
                    <li>{{ fieldname }}
                    {% set l_classe = fieldvalue.allowed_classes[0] %}
                        <ul>
                    {% for rel in obj.data(fieldname) %}
                            {% set casttype = l_classe.data_handler(l_classe.uid_fieldname()[0]).cast_type %}
                            {% set rel2 = casttype(rel) %}
                            <li><a href="show_object?classname={{ l_classe.__name__ }}&lodel_id={{ rel2 }}" target="_blank">{{ rel2 }}</a></li>
                    {% endfor %}
                        </ul></li>
                {% endif %}
            {% else %}
                <li> {{ fieldname }} : {{ obj.data(fieldname) }} </li>
            {% endif %}
        {% endif %}
    {% endfor %}
</ul>
{% endblock %}
